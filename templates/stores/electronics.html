{% extends "main.html" %}
{% load static %}
{% block title %}Electronics - Pearl Luxury Store{% endblock %}

{% block extra_css %}
<!-- optional per-page CSS -->
<style>
/* keep filter active style */
.filter-btn.active {
    background: #2563eb;
    color: white;
}
</style>
{% endblock %}

{% block content %}
<section class="section bg-gray-50">
    <div class="container">
        <div class="section-header">
            <h1 class="section-title">Electronics</h1>
            <p class="section-subtitle">Discover cutting-edge technology and premium electronic devices</p>
        </div>

        <!-- Search + Filters Row -->
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start gap-3 mb-4">
            <form method="GET" action="{% url 'search' %}" class="w-100 w-md-50">
                <div class="input-group">
                    <input type="text" name="q" class="form-control" placeholder="Search electronics..."
                           value="{{ request.GET.q|default:'' }}">
                    <button class="btn btn-primary" type="submit">Search</button>
                </div>
            </form>

            <div style="display:flex; gap:0.5rem; flex-wrap:wrap; align-items:center;">
                <button class="btn btn-secondary filter-btn active" data-filter="all">All Electronics</button>
                <button class="btn btn-secondary filter-btn" data-filter="tv">TVs & Displays</button>
                <button class="btn btn-secondary filter-btn" data-filter="laptop">Laptops</button>
                <button class="btn btn-secondary filter-btn" data-filter="gaming">Gaming</button>
                <button class="btn btn-secondary filter-btn" data-filter="audio">Audio</button>
            </div>
        </div>
    </div>
</section>

<section class="section">
    <div class="container">

        <!-- PRODUCTS GRID -->
        <div class="products-grid row g-4">

            {# If view provides a 'products' queryset, render it dynamically #}
            {% if products %}
                {% for product in products %}
                <div class="col-6 col-md-4 col-lg-3">
                    <div class="product-card animate-on-scroll position-relative card h-100">

                        {% if product.discount %}
                        <div class="product-badge position-absolute top-0 start-0 m-2 bg-danger text-light px-2 py-1" style="border-radius:6px;">
                            {{ product.discount }}% OFF
                        </div>
                        {% endif %}

                        {% if product.image %}
                            <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.name }}">
                        {% else %}
                            <!-- fallback sample image (local path uploaded) -->
                            <img src="/mnt/data/eab7ed32-e206-4791-8ac4-c5b9292ec4b3.png" class="card-img-top" alt="{{ product.name }}">
                        {% endif %}

                        <div class="card-body d-flex flex-column">
                            <h3 class="product-title h6 mb-1">{{ product.name }}</h3>
                            <div class="product-rating small text-muted mb-1">⭐⭐⭐⭐⭐ <span class="rating-count">({{ product.reviews_count|default:"0" }})</span></div>

                            <div class="product-price mb-2">
                                {% if product.discount %}
                                    <span class="text-decoration-line-through text-danger small">UGX {{ product.price }}</span>
                                    <span class="fw-bold ms-2">UGX {{ product.discounted_price }}</span>
                                {% else %}
                                    <span class="fw-bold">UGX {{ product.price }}</span>
                                {% endif %}
                            </div>

                            <div class="text-muted small mb-2">{{ product.stock_display }}</div>

                            <div class="card-buttons mt-auto d-flex gap-2">
                                <a href="{% url 'product_detail' product.pk %}" class="btn btn-sm btn-primary w-100">View</a>

                                <form action="{% url 'add_to_cart' product.id %}" method="POST" class="w-100">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-success w-100">Add to Cart</button>
                                </form>

                                <form action="{% url 'add_to_wishlist' product.id %}" method="POST" class="w-100">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-outline-danger w-100">♥</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}

            {% else %}
                {# FALLBACK: use the static sample cards from your original file (keeps design identical) #}
                <div class="col-6 col-md-4 col-lg-3">
                    <div class="product-card animate-on-scroll card h-100">
                        <div class="product-badge">Best Seller</div>
                        <div class="product-image" style="background-image: url('https://images.unsplash.com/photo-1593359677879-a4bb92f829d1?auto=format&fit=crop&w=800&q=80'); height:110px; background-size:cover; background-position:center;"></div>
                        <div class="card-body d-flex flex-column">
                            <h3 class="product-title h6 mb-1">4K Ultra HD Smart TV 55"</h3>
                            <div class="product-rating small text-muted mb-1">⭐⭐⭐⭐⭐ <span class="rating-count">(124)</span></div>
                            <div class="product-price mb-2">
                                <span class="text-decoration-line-through text-danger small">$1199</span>
                                <span class="fw-bold ms-2">$899</span>
                            </div>
                            <div class="card-buttons mt-auto d-flex gap-2">
                                <a href="#" class="btn btn-sm btn-primary w-100">View</a>
                                <button class="btn btn-sm btn-success w-100">Add to Cart</button>
                                <button class="btn btn-sm btn-outline-danger w-100">♥</button>
                            </div>
                        </div>
                    </div>
                </div>

                {# (repeat additional static sample cards if you'd like — omitted for brevity) #}
            {% endif %}
        </div>

        <!-- Load More / Pagination -->
        <div class="text-center mt-4">
            {% if is_paginated %}
                {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}" class="btn btn-outline-secondary">Previous</a>
                {% endif %}
                <span class="mx-2">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}" class="btn btn-outline-secondary">Next</a>
                {% endif %}
            {% else %}
                <button class="btn btn-secondary btn-rounded" onclick="showNotification('Loading more products...', 'info')">
                    Load More Products
                </button>
            {% endif %}
        </div>

    </div>
</section>

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/scripts.js' %}"></script>

<script>
// Local page JS to handle simple client-side filtering (keeps original UX)
document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
        this.classList.add('active');
        const filter = this.dataset.filter;

        document.querySelectorAll('.products-grid .product-card').forEach(card => {
            // if server-rendered products have data-category attribute, this will work
            const cat = card.dataset.category || 'all';
            if (filter === 'all' || cat === filter) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        });
    });
});

// helper notification function (simple)
function showNotification(msg, type='info') {
    alert(msg);
}
</script>
{% endblock %}
